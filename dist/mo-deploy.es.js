import e from"node:fs";import s from"commander";import n from"node:os";import t from"node:path";var d={name:"mo-deploy",version:"1.0.2",description:"自动化部署服务",main:"lib/service.js",homepage:"",keywords:["deploy","cli"],bin:{"mo-deploy":"bin/mo-deploy.js"},scripts:{build:"rollup -c --bundleConfigAsCjs"},license:"MIT",dependencies:{archiver:"^5.0.2",chalk:"^4.1.0",commander:"^6.1.0",dayjs:"^1.10.4",inquirer:"^7.3.3",minimist:"^1.2.5","node-ssh":"^11.0.0",ora:"^5.1.0",prettier:"^2.1.1"},devDependencies:{"@rollup/plugin-json":"^6.0.0","@rollup/plugin-terser":"^0.4.0",rollup:"^3.3.0"}};console.log("packageInfo ",d);var o={packageInfo:d,deployConfigPath:`${t.join(process.cwd())}/mo-deploy.config.js`,inquirerConfig:[{type:"input",name:"projectName",message:"请输入项目名称",default:n.existsSync(`${t.join(process.cwd())}/package.json`)?require(`${process.cwd()}/package.json`).name:""},{type:"input",name:"privateKey",message:"请输入本地私钥地址",default:`${n.homedir()}/.ssh/id_rsa`},{type:"password",name:"passphrase",message:"请输入本地私钥密码",default:""},{type:"checkbox",name:"deployEnvList",message:"请选择需要部署的环境",choices:[{name:"dev",checked:!0},{name:"test"},{name:"prod"}]},{type:"input",name:"devName",message:"环境名称",default:"开发环境",when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devScript",message:"打包命令",default:"npm run build:dev",when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devHost",message:"服务器地址",when:e=>e.deployEnvList.includes("dev")},{type:"number",name:"devPort",message:"服务器端口号",default:22,when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devUsername",message:"用户名",default:"root",when:e=>e.deployEnvList.includes("dev")},{type:"password",name:"devPassword",message:"密码",when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devDistPath",message:"本地打包目录",default:"dist",when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devWebDir",message:"部署路径",when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"devBakDir",message:"备份路径",when:e=>e.deployEnvList.includes("dev")},{type:"confirm",name:"devIsRemoveRemoteFile",message:"是否删除远程文件",default:!0,when:e=>e.deployEnvList.includes("dev")},{type:"confirm",name:"devIsRemoveLocalFile",message:"是否删除本地打包文件",default:!0,when:e=>e.deployEnvList.includes("dev")},{type:"input",name:"testName",message:"环境名称",default:"测试环境",when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testScript",message:"打包命令",default:"npm run build:test",when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testHost",message:"服务器地址",when:e=>e.deployEnvList.includes("test")},{type:"number",name:"testPort",message:"服务器端口号",default:22,when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testUsername",message:"用户名",default:"root",when:e=>e.deployEnvList.includes("test")},{type:"password",name:"testPassword",message:"密码",when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testDistPath",message:"本地打包目录",default:"dist",when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testWebDir",message:"部署路径",when:e=>e.deployEnvList.includes("test")},{type:"input",name:"testBakDir",message:"备份路径",when:e=>e.deployEnvList.includes("test")},{type:"confirm",name:"testIsRemoveRemoteFile",message:"是否删除远程文件",default:!0,when:e=>e.deployEnvList.includes("test")},{type:"confirm",name:"testIsRemoveLocalFile",message:"是否删除本地打包文件",default:!0,when:e=>e.deployEnvList.includes("test")},{type:"input",name:"prodName",message:"环境名称",default:"生产环境",when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodScript",message:"打包命令",default:"npm run build:prod",when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodHost",message:"服务器地址",when:e=>e.deployEnvList.includes("prod")},{type:"number",name:"prodPort",message:"服务器端口号",default:22,when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodUsername",message:"用户名",default:"root",when:e=>e.deployEnvList.includes("prod")},{type:"password",name:"prodPassword",message:"密码",when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodDistPath",message:"本地打包目录",default:"dist",when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodWebDir",message:"部署路径",when:e=>e.deployEnvList.includes("prod")},{type:"input",name:"prodBakDir",message:"备份路径",when:e=>e.deployEnvList.includes("prod")},{type:"confirm",name:"prodIsRemoveRemoteFile",message:"是否删除远程文件",default:!0,when:e=>e.deployEnvList.includes("prod")},{type:"confirm",name:"prodIsRemoveLocalFile",message:"是否删除本地打包文件",default:!0,when:e=>e.deployEnvList.includes("prod")}]};console.log("packageInfo ",o);class p{constructor(){s.version(o.packageInfo.version,"-v, --version","输出当前版本号"),s.helpOption("-h, --help","获取帮助"),s.addHelpCommand(!1),(()=>{const n=`${__dirname}/commands`;e.readdirSync(`${n}`).forEach((e=>{const t=require(`${n}/${e}`),d=e.split(".")[0],o=e.charAt(0);"deploy"===d?s.command(d).description(t.description).alias(o).option("-m, --mode <mode>","setup deploy mode").action((e=>{t.apply(e.mode)})):s.command(d).description(t.description).alias(o).action((()=>{t.apply()}))}))})()}run(e,n={},t=[]){s.parse(t,{from:"user"})}}export{p as default};
